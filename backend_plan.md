# AIｽﾀｯｸﾁｬﾝ バックエンド開発計画

## 目的
PC上で動作するAIｽﾀｯｸﾁｬﾝのバックエンドAPIをFastAPIで構築し、uvで環境構築を行い、簡易的なフロントエンドと連携させて、基本的な会話機能と状態管理機能を実現する。簡易フロントエンドでは、バックエンドからの情報に基づいてアバターの表情（口の動き）を変化させる。

## 技術スタック
*   **言語:** Python
*   **バックエンドフレームワーク:** FastAPI
*   **環境構築ツール:** uv
*   **AIモデル連携:** Gemini APIなどを利用。

## 主要機能（APIエンドポイント案）

*   `/chat` (POST): ユーザーからのテキストを受け取り、AIモデルに渡して応答テキストと、PC上のフロントエンドで表示・シミュレーションするための表情・動きに関するデータ（例: 口の開閉状態を示すブール値や、表情パターンを示す文字列/数値など、JSON形式のパラメータ）を生成し、返す。
*   `/status` (GET/POST): AIｽﾀｯｸﾁｬﾝの現在の状態（機嫌など）を取得・更新する。PC上のフロントエンドで状態を表示・操作するために使用。
*   `/config` (GET/POST): 設定情報（AIモデルのAPIキーなど）を管理する。PC上のフロントエンドから設定を読み書きするために使用。

## 開発ステップ案

1.  **uvのインストール:** uvをシステムにインストールします。
2.  **プロジェクトディレクトリの作成:** AIｽﾀｯｸﾁｬﾝのバックエンドプロジェクト用のディレクトリを作成します。
3.  **仮想環境の作成とアクティベート:** uvを使って仮想環境を作成し、アクティベートします。
4.  **必要なライブラリのインストール:** uvを使ってFastAPI, uvicorn (FastAPIのASGIサーバー), requests, google-generativeai などのライブラリをインストールします。
5.  **FastAPIアプリケーションの基本構造作成:** `app.py` ファイルにFastAPIアプリケーションの基本構造を作成します。
6.  **APIエンドポイントの設計:** `/chat`, `/status`, `/config` エンドポイントについて、リクエスト・レスポンスの形式を具体的に定義します。特に `/chat` の応答に含める表情・動きデータの形式（例: `{"text": "こんにちは", "mouth_open": true}` のようなシンプルなJSON）を決定します。Pydanticモデルを使用することを検討します。
7.  **AIモデル連携の実装:** Gemini APIなどを呼び出し、会話応答テキストと、応答内容（特にテキスト）に基づいた表情・動きに関するデータを生成するロジックを実装します。
8.  **`/chat` エンドポイントの実装:** ユーザーからの入力テキストを受け付け、AIモデル連携ロジックを呼び出し、生成された応答テキストと表情・動きデータをJSON形式で返すAPIエンドポイントをFastAPIで作成します。
9.  **状態管理機能の実装:** AIｽﾀｯｸﾁｬﾝの状態を保持・更新するシンプルな仕組み（例: Pythonのクラスや辞書）を実装。「構わなかったら病む/勝手に起動」のトリガーとなる、最終会話時刻の記録と定期的なチェック機構を検討・実装します。
10. **`/status` エンドポイントの実装:** 状態の取得・更新APIエンドポイントをFastAPIで実装します。
11. **設定管理機能の実装:** APIキーなどの設定情報を保持・読み込みするシンプルな仕組み（例: `.env` ファイルと `python-dotenv`）を実装します。
12. **`/config` エンドポイントの実装:** 設定情報の取得・更新APIエンドポイントをFastAPIで実装します。
13. **簡易フロントエンド（またはテストクライアント）の開発:** バックエンドAPIと連携し、テキストの送受信、状態の表示、設定の読み書きができるPC上のアプリケーション（例: Pythonの `requests` ライブラリを使ったスクリプト、簡単なHTML/JavaScriptページ）を作成します。このフロントエンドは、`/chat` エンドポイントから受け取った表情・動きデータに基づいてアバターの表示を更新する機能を持ちます。
14. **バックエンドとフロントエンドの連携確認:** PC上でFastAPIバックエンドと簡易フロントエンドを起動し、意図した通りに連携できるかテストします。
15. **テストとデバッグ:** 各機能の単体テスト、結合テストを実施します。
16. **（将来）M5Stack連携の検討:** PC上での動作が確認できた後、M5Stackとの実際の連携方法（通信プロトコル、データ形式など）を検討し、必要に応じてバックエンドを修正・拡張します。

## API構成イメージ

```mermaid
graph LR
    A[PC上の簡易フロントエンド] --> B(FastAPIバックエンド)
    B --> C{APIエンドポイント}
    C --> D[/chat]
    C --> E[/status]
    C --> F[/config]
    D --> G(AIモデル連携)
    G --> H[Gemini APIなど]
    B --> I(状態管理)
    B --> J(設定管理)